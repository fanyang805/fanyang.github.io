<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Fan's site | ROS Simulation</title>
<meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design.
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->
<!-- 
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">
 -->
<!-- <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>"> -->
<link rel="shortcut icon" href="/assets/img/favicon.ico">
<link rel="stylesheet" href="/assets/css/main.css">

<link rel="canonical" href="/projects/ROS/ros-simulation/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

  <script src="/assets/js/theme.js"></script>
  <!-- Load DarkMode JS -->
<script src="/assets/js/dark_mode.js"></script>






    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav sticky-bottom-footer">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="/">
        <i class="fas fa-fan fa-spin"></i>
       Fan's site
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              About
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item ">
            <a class="nav-link" href="/blog/">
              Blog 
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/course-work/">
                Course Work
                
              </a>
          </li>
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                Projects
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                Publications
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/research/">
                Research
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/services/">
                Services
                
              </a>
          </li>
          
          
          
          
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      <div class="post">

  <header class="post-header">
    <h1 class="post-title">ROS Simulation</h1>
    <!-- <p class="post-description">Simulate the SLAM and navigation in Gazebo using ROS navigation stack. In the SLAM simulation, user specify the pose for robot to visit in the unknown environment. During the exploration robot computes the occupancy grid map. Once the map is obtained, we can perform the Navigation simulation. Given the goal pose specified by user in rviz, the robot moves to the target and avoids the obstacle without teleoperation during the navigation. I also simulate the 
SLAM with multiple robots in Gazebo. Each robot moves around and computes its own map with seperate gmapping node. Then the maps are merged to a single map by multirobot-map-merge package. Further the project includes multi-robot navigation simulation. The robots have to avoid the collision with not only the static obstacle but not other moving robots. 
</p> -->
  </header>

  <article>
    <p>In this project, I performed the SLAM and Navigation in Gazebo using ROS. In SLAM simulation, robots creates 2D occupancy map by exploring the unknown environment. In Navigation simulation, robots move to the specified pose without the teleoperation, given the map created in the SLAM simulation.</p>

<h3 id="dependencies">Dependencies</h3>

<p>Please make sure the ROS 2D navigation stack is properly installed. Use the command below to install.<br />
<code class="language-plaintext highlighter-rouge">sudo apt-get install ros-melodic-navigation</code> (replace the melodic by your ros version).</p>

<p>Or install from <a href="https://github.com/ros-planning/navigation" target="blank">source</a>.</p>

<p>Gmapping package is also required. To install gmapping<br />
<code class="language-plaintext highlighter-rouge">sudo apt-get install ros-melodic-slam-gmapping</code></p>

<p>Note that ROS noetic does not support the parameter <code class="language-plaintext highlighter-rouge">tf_prefix</code> in <code class="language-plaintext highlighter-rouge">robot_state_publisher</code> as discussed in issue <a href="https://github.com/ros/robot_state_publisher/issues/125" target="blank">#125</a>. Therefore, the multi-robot SLAM and navigation launch files do not work in ROS noetic. There is a <a href="https://github.com/ros/robot_state_publisher/pull/139" target="blank">pull request</a> discussed. Hopefully the PR will be merged soon.</p>

<h2 id="slam-in-gazebo">SLAM in Gazebo</h2>

<p>(1) Open the Gazebo simulation environment<br />
<code class="language-plaintext highlighter-rouge">roslaunch ros_sim turtlebot3_world.launch</code></p>

<p>(2) Run the SLAM nodes<br />
<code class="language-plaintext highlighter-rouge">roslaunch ros_sim turtlebot3_slam.launch</code></p>

<p>(3) Now we need robot to move around the unknown area and compute the occupancy map. A simple method to control the robot is to publish the twist message to topic <code class="language-plaintext highlighter-rouge">/cmd_vel</code> or use a teleop node. However controlling robot directly may cause the collision with the obstacle especially for people (like me) not comfortable with keyboard teleop. Here we use move_base node so that we can specify the goal pose by clicking on 2D Nav Goal button on rviz tool panel and move_base node can compute a safer velocity command based on the odometry and laser scan reading.</p>

<div class="row justify-content-center">
    <div class="col">
          <img class="img-fluid z-depth-1" src="/projects/ROS/assets/img/slam.gif" alt="" />
    </div>
</div>
<p><br />
(4) Save the map after scanning every corner of the map.<br />
<code class="language-plaintext highlighter-rouge">rosrun map_server map_saver -f ~/map</code></p>

<div class="row justify-content-center">
    <div class="col">
      <div class="w-50 mx-auto" style="background-color: white;">
          <img class="img-fluid z-depth-1" src="/projects/ROS/assets/img/tb3_map.png" alt="" />
      </div>
    </div>
</div>
<p><br /></p>

<p>The computation graph is shown as the figure below. The gazebo node sends the laser scan information to gmapping node through topic <code class="language-plaintext highlighter-rouge">/scan</code>. The gmapping node computes and publishes the occupancy map through topic <code class="language-plaintext highlighter-rouge">/map</code>. By clicking the pose in rviz (treated as a hidden debugging node in the rqt graph), rviz node publishes a goal to move_base node by topic <code class="language-plaintext highlighter-rouge">/move_base_simple/goal</code>. Besides <code class="language-plaintext highlighter-rouge">/move_base_simple/goal</code>, move_base node also subscribes to <code class="language-plaintext highlighter-rouge">/scan</code>, <code class="language-plaintext highlighter-rouge">/odom</code> and <code class="language-plaintext highlighter-rouge">/map</code> (initially unknown). The move_base node computes and publishes the velocity command to robot (in gazebo node) through topic <code class="language-plaintext highlighter-rouge">/cmd_vel</code>. Following the velocity command, robot tries to reach the assigned goal without collision with obstacles.</p>

<div class="row justify-content-center">
    <div class="col">
          <img class="img-fluid z-depth-1" src="/projects/ROS/assets/img/rqt_slam.png" alt="" />
    </div>
</div>
<p><br /></p>

<p>Complete video:</p>

<div class="row justify-content-center">
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/aEVwwo_0fUk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</div>
<p><br /></p>

<h2 id="navigation-in-gazebo">Navigation in Gazebo</h2>

<p>(1) Open the Gazebo simulation environment<br />
<code class="language-plaintext highlighter-rouge">roslaunch ros_sim turtlebot3_world.launch</code></p>

<p>(2) Run the navigation nodes<br />
<code class="language-plaintext highlighter-rouge">roslaunch ros_sim turtlebot3_navigation.launch</code></p>

<p>(3) Specify the initial pose of robot by 2D Pose Estimate in rviz. This is used for initilizing the amcl localization node. It is not necessary to specify the exact initial pose because amcl node can adjust the robot’s pose properly by laser scan.</p>

<p>(4) Specify the goal pose by 2D Nav Goal in rviz. Since the complete map is given to move_base node, a global path (black line) for robot to reach the goal can be computed.</p>

<div class="row justify-content-center">
    <div class="col">
          <img class="img-fluid z-depth-1" src="/projects/ROS/assets/img/nav.gif" alt="" />
    </div>
</div>
<p><br /></p>

<p>In the navigation, move_base node obtains the complete map published by the map_server node. Thus a global path beween robot and goal can be computed. The amcl node implements the particle filter to track the robot in the given map. By selecting the initial pose in rviz, the amcl node is initilized through topic <code class="language-plaintext highlighter-rouge">/initialpose</code>. It also subscribes to the laser scan through <code class="language-plaintext highlighter-rouge">/scan</code> topic for localization and publishes the set of the pose estimates through topic <code class="language-plaintext highlighter-rouge">/particlecloud</code> shown in rviz and the transform between map frame (reference frame) and odom frame(target frame) through topic <code class="language-plaintext highlighter-rouge">/tf</code>.</p>

<div class="row justify-content-center">
    <div class="col">
          <img class="img-fluid z-depth-1" src="/projects/ROS/assets/img/rqt_navigation.png" alt="" />
    </div>
</div>
<p><br /></p>

<p>Complete video:</p>

<div class="row justify-content-center">
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/uAA04tD8lis" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</div>
<p><br /></p>

<h2 id="multi-robot-slam">Multi-robot SLAM</h2>

<p>Note: this example requires <a href="https://github.com/hrnr/m-explore" target="blank">multirobot_map_merge package</a>. Please make sure the package and the dependencies are properly installed.</p>

<p>(1) Open the gazebo environment with multiple robots<br />
<code class="language-plaintext highlighter-rouge">roslaunch ros_sim multi_turtlebot3_slam_world.launch</code></p>

<p>(2) Run the multi-robot slam nodes<br />
<code class="language-plaintext highlighter-rouge">roslaunch ros_sim multi_turtlebot3_slam.launch</code></p>

<p>(3) Specify the goal poses for multiple robots. There are two 2D Nav Goal bottons in rviz. Each robot will be exploiting the unknown area and create its own map. The maps are published to the map merge node through topic <code class="language-plaintext highlighter-rouge">/tb3_#/map</code> (where # is the index of the robot).</p>

<div class="row justify-content-center">
    <div class="col">
          <img class="img-fluid z-depth-1" src="/projects/ROS/assets/img/multi-slam.gif" alt="" />
    </div>
</div>
<p><br /></p>

<p>(4) Save the map after every corner of the map is scanned by robots together.<br />
<code class="language-plaintext highlighter-rouge">rosrun map_server map_saver -f ~/map</code></p>

<div class="row justify-content-center">
    <div class="col">
      <div class="w-50 mx-auto" style="background-color: white;">
          <img class="img-fluid z-depth-1" src="/projects/ROS/assets/img/multi_slam_map.png" alt="" />
      </div>
    </div>
</div>
<p><br /></p>

<p>The difference between the single robot and multi-robot mapping is that each robot has a gmapping and move_base nodes under its namespace (i.e., tb3_0 and tb3_1). A map_merge node subscribes to the topic <code class="language-plaintext highlighter-rouge">/tb3_0/map</code> and <code class="language-plaintext highlighter-rouge">/tb3_1/map</code> published by each individual robot.</p>

<div class="row justify-content-center">
    <div class="col">
          <img class="img-fluid z-depth-1" src="/projects/ROS/assets/img/rqt_multi_slam.png" alt="" />
    </div>
</div>
<p><br /></p>

<p>Complete video:</p>

<div class="row justify-content-center">
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/-PFv5AyaAPE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</div>
<p><br /></p>

<h2 id="multi-robot-navigation">Multi-robot navigation</h2>

<p>(1) Open the gazebo environment with multiple robots.<br />
<code class="language-plaintext highlighter-rouge">roslaunch ros_sim multi_turtlebot3_nav_world.launch</code></p>

<p>(2) Run multi-robot navigation nodes.<br />
<code class="language-plaintext highlighter-rouge">roslaunch ros_sim multi_turtlebot3_navigation.launch</code></p>

<p>(3) Specify the initial poses of each robot in rviz. This step initialized the amcl node for each robot. It is ok to just specify the approximate poses.</p>

<div class="row justify-content-center">
    <div class="col">
          <img class="img-fluid z-depth-1" src="/projects/ROS/assets/img/multi-nav-start.gif" alt="" />
    </div>
</div>
<p><br />
(4) Specify the goal poses for each robot. The robot will move to the goal. By properly tuning the parameters of move_base node in param folder, robot is able to avoid the obstacles.</p>

<div class="row justify-content-center">
    <div class="col">
          <img class="img-fluid z-depth-1" src="/projects/ROS/assets/img/multi-nav.gif" alt="" />
    </div>
</div>
<p><br /></p>

<p>Each robot has its own amcl node for localization, which is defined under the robot’s namespace <code class="language-plaintext highlighter-rouge">tb3_0</code> and <code class="language-plaintext highlighter-rouge">tb3_1</code>. Therefore the amcl’s published and subscribed topics are under the robot’s namespace. Make sure <code class="language-plaintext highlighter-rouge">use_map_topic=true</code> so that the map is received by subscription instead of making a service call. And <code class="language-plaintext highlighter-rouge">remap from="map" to="/map"</code> so that all amcl nodes subscribe to the same global map published by the map_server node.</p>

<div class="row justify-content-center">
    <div class="col">
          <img class="img-fluid z-depth-1" src="/projects/ROS/assets/img/rqt_multi_nav.png" alt="" />
    </div>
</div>
<p><br /></p>

<p>Compelete video:</p>

<div class="row justify-content-center">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/Ap1es0nfnyQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</div>
<p><br /></p>

<h2 id="reference">Reference</h2>

<ul>
  <li>gmapping package: <a href="http://wiki.ros.org/gmapping">http://wiki.ros.org/gmapping</a></li>
  <li>move_base package: <a href="http://wiki.ros.org/move_base">http://wiki.ros.org/move_base</a></li>
  <li>amcl package: <a href="http://wiki.ros.org/amcl">http://wiki.ros.org/amcl</a></li>
  <li>tf introduction: <a href="http://wiki.ros.org/tf">http://wiki.ros.org/tf</a></li>
  <li>Setup and Configuration of the Navigation Stack: <a href="http://wiki.ros.org/navigation/Tutorials/RobotSetup">http://wiki.ros.org/navigation/Tutorials/RobotSetup</a></li>
  <li>Turtlebot3 simulation: <a href="https://emanual.robotis.com/docs/en/platform/turtlebot3/simulation/">https://emanual.robotis.com/docs/en/platform/turtlebot3/simulation/</a></li>
  <li>Multiple turtlebot3 mapping: <a href="https://wiki.nps.edu/pages/viewpage.action?pageId=1018462212">https://wiki.nps.edu/pages/viewpage.action?pageId=1018462212</a> –&gt;</li>
</ul>

  </article>

</div>

    </div>

    <!-- Footer -->

    
<footer class="sticky-bottom mt-5">
  <div class="container">
    &copy; Copyright 2021 Fan  Yang.
    
    
    
    Last updated: November 25, 2021.
    
  </div>
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
